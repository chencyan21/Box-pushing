# 跳一跳游戏说明

![游戏主界面](assets/Game.png)

## 项目架构

### 前后端分离设计
- **前端**: `jump_game.html` - 游戏界面和交互逻辑
- **后端**: `ai_agent.py` - AI推荐服务和物理计算
- **通信**: RESTful API接口

### 文件结构
```
Box-pushing/
├── jump_game.html          # 游戏主文件
├── ai_agent.py             # Python AI Agent服务器
├── requirements.txt        # Python依赖包
├── start_full_game.bat     # 一键启动脚本
├── install_dependencies.bat # 环境安装脚本
├── README.md               # 说明文档
└── AI_AGENT_GUIDE.md       # AI使用指南
```

## 游戏概述
这是一个基于物理引擎的跳一跳游戏，玩家需要通过控制跳跃力度来让角色成功跳到目标平台上。

## 游戏机制

### 跳跃物理
- **水平速度**: 跳跃力度 × 0.15
- **垂直速度**: 跳跃力度 × -0.25 (负值表示向上)
- **重力加速度**: 0.5 (使角色在空中下落)
- **跳跃力度范围**: 0~100

### 判定机制
判定时机：角色下落过程中进行碰撞检测

#### 两级判定系统：
1. **矩形碰撞检测**：判断玩家与目标平台是否存在矩形重叠
2. **精细判定**：
   - 垂直接近判定：玩家底部距离平台顶部的垂直距离小于10像素
   - 水平落点判定：玩家中心点的水平位置在平台左右边界之间

两个条件同时满足时判定为"落地成功"，触发得分并生成新平台。

## 游戏状态信息
在每次跳跃前，界面会显示：

**坐标信息**
- 玩家位置 (px, py)：当前角色的水平和垂直坐标
- 目标平台位置 (L, T, R)：
  - L (左边界)：平台的最左侧X坐标
  - T (顶部)：平台的最上方Y坐标（着陆目标）
  - R (右边界)：平台的最右侧X坐标

**物理运动参数**
- 横向速度倍率 (0.10)：
  - 控制水平飞行距离
  - 计算公式：水平速度 = 跳跃力度 × 0.10
- 纵向速度倍率 (-0.25)：
  - 控制跳跃高度（负值表示向上）
  - 计算公式：垂直速度 = 跳跃力度 × (-0.25)
- 重力加速度 (0.75)：
  - 控制下落速度的增加率
  - 每帧垂直速度增加0.75

**运动计算**
每个时间步长的位置更新：
1. 水平位置：x = x + 水平速度（匀速）
2. 垂直位置：y = y + 垂直速度
3. 垂直速度：vy = vy + 重力（加速下落）

## 操作方法
1. 在输入框中输入推荐的跳跃力度 (0-100的整数)
2. 点击"跳跃"按钮或按空格键/回车键执行跳跃
3. 观察角色的跳跃轨迹和着陆情况
4. 成功着陆后继续下一次跳跃
5. 掉落或错过平台将导致游戏结束

## 游戏特色
- 实时物理模拟
- 可视化的跳跃轨迹
- 动态平台生成
- 响应式界面设计
- 详细的状态信息显示

## 技术实现
- HTML5 Canvas 绘图
- JavaScript 物理引擎
- 实时碰撞检测
- 流畅的动画效果

## 游戏目标
通过精确控制跳跃力度，连续成功着陆在平台上，获得更高的分数！

## 提示
- 观察目标平台的距离和高度差
- 根据物理参数计算合适的跳跃力度
- 力度过小可能跳不到，力度过大可能跳过头
- 利用显示的状态信息来优化跳跃策略

## 快速启动

### 方法一：一键启动（推荐）
1. 双击运行 `install_dependencies.bat` 安装环境
2. 双击运行 `start_full_game.bat` 启动游戏

### 方法二：手动启动
1. 安装Python依赖：`pip install -r requirements.txt`
2. 启动AI服务器：`python ai_agent.py`
3. 在浏览器中打开 `jump_game.html`

## AI Agent功能

### 智能推荐系统
- **AI模式**: 使用Gemini-2.5-flash进行智能计算
- **物理模式**: 备用的数学物理计算算法
- **自动降级**: API失败时自动切换到物理计算

### API接口
- `POST /api/set_api_key` - 设置Gemini API Key
- `POST /api/get_recommendation` - 获取跳跃力度推荐
- `GET /api/health` - 服务器健康检查

## 环境要求

### Python环境
- Python 3.7+
- Flask 2.3.3
- Flask-CORS 4.0.0
- google-generativeai 0.3.2

### 浏览器支持
- Chrome/Edge (推荐)
- Firefox
- Safari
